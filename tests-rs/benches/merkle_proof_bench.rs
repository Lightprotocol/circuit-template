use std::collections::HashMap;
use std::fs::File;
use ark_bn254::Bn254;
use ark_circom::{CircomBuilder, CircomConfig, CircomReduction, read_zkey, WitnessCalculator};
use ark_circom::circom::Inputs;
use ark_std::rand::thread_rng;
use criterion::{Criterion, criterion_group, criterion_main};
use num_bigint::BigInt;
use std::str::FromStr;
use ark_crypto_primitives::snark::SNARK;
use ark_groth16::Groth16;

type GrothBn = Groth16<Bn254>;

struct MerkleInputs {
    root: BigInt,
    leaf: BigInt,
    in_path_indices: BigInt,
    in_path_elements: Vec<BigInt>,
}

pub fn groth16_merkle_proof_bench_22(c: &mut Criterion) {
    let MERKLE_INPUTS_22: MerkleInputs = MerkleInputs {
        root: BigInt::from_str("18475809180757524180094921250867816994543302831149038483389836765641083762504").unwrap(),
        leaf: BigInt::from_str("18586133768512220936620570745912940619677854269274689475585506675881198879027").unwrap(),
        in_path_indices: BigInt::from_str("0").unwrap(),
        in_path_elements: vec![
            BigInt::from_str("14522046728041339886521211779101644712859239303505368468566383402165481390632").unwrap(),
            BigInt::from_str("12399300409582020702502593817695692114365413884629119646752088755594619792099").unwrap(),
            BigInt::from_str("8395588225108361090185968542078819429341401311717556516132539162074718138649").unwrap(),
            BigInt::from_str("4057071915828907980454096850543815456027107468656377022048087951790606859731").unwrap(),
            BigInt::from_str("3743829818366380567407337724304774110038336483209304727156632173911629434824").unwrap(),
            BigInt::from_str("3362607757998999405075010522526038738464692355542244039606578632265293250219").unwrap(),
            BigInt::from_str("20015677184605935901566129770286979413240288709932102066659093803039610261051").unwrap(),
            BigInt::from_str("10225829025262222227965488453946459886073285580405166440845039886823254154094").unwrap(),
            BigInt::from_str("5686141661288164258066217031114275192545956158151639326748108608664284882706").unwrap(),
            BigInt::from_str("13358779464535584487091704300380764321480804571869571342660527049603988848871").unwrap(),
            BigInt::from_str("20788849673815300643597200320095485951460468959391698802255261673230371848899").unwrap(),
            BigInt::from_str("18755746780925592439082197927133359790105305834996978755923950077317381403267").unwrap(),
            BigInt::from_str("10861549147121384785495888967464291400837754556942768811917754795517438910238").unwrap(),
            BigInt::from_str("7537538922575546318235739307792157434585071385790082150452199061048979169447").unwrap(),
            BigInt::from_str("19170203992070410766412159884086833170469632707946611516547317398966021022253").unwrap(),
            BigInt::from_str("9623414539891033920851862231973763647444234218922568879041788217598068601671").unwrap(),
            BigInt::from_str("3060533073600086539557684568063736193011911125938770961176821146879145827363").unwrap(),
            BigInt::from_str("138878455357257924790066769656582592677416924479878379980482552822708744793").unwrap(),
            BigInt::from_str("15800883723037093133305280672853871715176051618981698111580373208012928757479").unwrap(),
            BigInt::from_str("9637860505097446354938615465189848881949005695944686439357073260024670396314").unwrap(),
            BigInt::from_str("4230405496594752177767097648850446961113946544270644047257607903635152146286").unwrap(),
            BigInt::from_str("19628479516823977714752192155233860702021283416105762098991390975512642753356").unwrap(),
        ],
    };

    let WTNS_PATH = "../build/merkle22/merkle22_js/merkle22.wasm";
    let R1CS_PATH = "../build/merkle22/merkle22.r1cs";

    merkle_proof(c, MERKLE_INPUTS_22, WTNS_PATH, R1CS_PATH);
}

pub fn groth16_merkle_proof_bench_30(c: &mut Criterion) {
    let MERKLE_INPUTS_30: MerkleInputs = MerkleInputs {
        root: BigInt::from_str("16155362655714532719199197748131979703883742326298770334973206815681668404150").unwrap(),
        leaf: BigInt::from_str("18586133768512220936620570745912940619677854269274689475585506675881198879027").unwrap(),
        in_path_indices: BigInt::from_str("0").unwrap(),
        in_path_elements: vec![
            BigInt::from_str("14522046728041339886521211779101644712859239303505368468566383402165481390632").unwrap(),
            BigInt::from_str("12399300409582020702502593817695692114365413884629119646752088755594619792099").unwrap(),
            BigInt::from_str("8395588225108361090185968542078819429341401311717556516132539162074718138649").unwrap(),
            BigInt::from_str("4057071915828907980454096850543815456027107468656377022048087951790606859731").unwrap(),
            BigInt::from_str("3743829818366380567407337724304774110038336483209304727156632173911629434824").unwrap(),
            BigInt::from_str("3362607757998999405075010522526038738464692355542244039606578632265293250219").unwrap(),
            BigInt::from_str("20015677184605935901566129770286979413240288709932102066659093803039610261051").unwrap(),
            BigInt::from_str("10225829025262222227965488453946459886073285580405166440845039886823254154094").unwrap(),
            BigInt::from_str("5686141661288164258066217031114275192545956158151639326748108608664284882706").unwrap(),
            BigInt::from_str("13358779464535584487091704300380764321480804571869571342660527049603988848871").unwrap(),
            BigInt::from_str("20788849673815300643597200320095485951460468959391698802255261673230371848899").unwrap(),
            BigInt::from_str("18755746780925592439082197927133359790105305834996978755923950077317381403267").unwrap(),
            BigInt::from_str("10861549147121384785495888967464291400837754556942768811917754795517438910238").unwrap(),
            BigInt::from_str("7537538922575546318235739307792157434585071385790082150452199061048979169447").unwrap(),
            BigInt::from_str("19170203992070410766412159884086833170469632707946611516547317398966021022253").unwrap(),
            BigInt::from_str("9623414539891033920851862231973763647444234218922568879041788217598068601671").unwrap(),
            BigInt::from_str("3060533073600086539557684568063736193011911125938770961176821146879145827363").unwrap(),
            BigInt::from_str("138878455357257924790066769656582592677416924479878379980482552822708744793").unwrap(),
            BigInt::from_str("15800883723037093133305280672853871715176051618981698111580373208012928757479").unwrap(),
            BigInt::from_str("9637860505097446354938615465189848881949005695944686439357073260024670396314").unwrap(),
            BigInt::from_str("4230405496594752177767097648850446961113946544270644047257607903635152146286").unwrap(),
            BigInt::from_str("19628479516823977714752192155233860702021283416105762098991390975512642753356").unwrap(),
            BigInt::from_str("10752138434985301760908661169020382294921002953248926091133111238568141278402").unwrap(),
            BigInt::from_str("8832152504624700401449770057167890569321131921984669229014434815887358390937").unwrap(),
            BigInt::from_str("11347004614081717932944125175785689632220946418443796094366660816613526692072").unwrap(),
            BigInt::from_str("3051443875805177528988564130066437194733628010868431898106208700997051204511").unwrap(),
            BigInt::from_str("3280843894647711167665805442383284798908343826207825003222378769830753112564").unwrap(),
            BigInt::from_str("2885437127318082792676156679496224267537134149125889704006255090894418859184").unwrap(),
            BigInt::from_str("20997803921471190972687386845252368449417136221584210407219428552891406603152").unwrap(),
            BigInt::from_str("5526870653502991543758325832857419578849790775006776838934982108475732717180").unwrap(),
        ],
    };

    let WTNS_PATH = "../build/merkle30/merkle30_js/merkle30.wasm";
    let R1CS_PATH = "../build/merkle30/merkle30.r1cs";

    merkle_proof(c, MERKLE_INPUTS_30, WTNS_PATH, R1CS_PATH);
}

pub fn groth16_merkle_proof_bench_40(c: &mut Criterion) {
    let MERKLE_INPUTS_40: MerkleInputs = MerkleInputs {
        root: BigInt::from_str("15875569100697431086586597600507815363491130846049986223853046145098549482034").unwrap(),
        leaf: BigInt::from_str("18586133768512220936620570745912940619677854269274689475585506675881198879027").unwrap(),
        in_path_indices: BigInt::from_str("0").unwrap(),
        in_path_elements: vec![
            BigInt::from_str("14522046728041339886521211779101644712859239303505368468566383402165481390632").unwrap(),
            BigInt::from_str("12399300409582020702502593817695692114365413884629119646752088755594619792099").unwrap(),
            BigInt::from_str("8395588225108361090185968542078819429341401311717556516132539162074718138649").unwrap(),
            BigInt::from_str("4057071915828907980454096850543815456027107468656377022048087951790606859731").unwrap(),
            BigInt::from_str("3743829818366380567407337724304774110038336483209304727156632173911629434824").unwrap(),
            BigInt::from_str("3362607757998999405075010522526038738464692355542244039606578632265293250219").unwrap(),
            BigInt::from_str("20015677184605935901566129770286979413240288709932102066659093803039610261051").unwrap(),
            BigInt::from_str("10225829025262222227965488453946459886073285580405166440845039886823254154094").unwrap(),
            BigInt::from_str("5686141661288164258066217031114275192545956158151639326748108608664284882706").unwrap(),
            BigInt::from_str("13358779464535584487091704300380764321480804571869571342660527049603988848871").unwrap(),
            BigInt::from_str("20788849673815300643597200320095485951460468959391698802255261673230371848899").unwrap(),
            BigInt::from_str("18755746780925592439082197927133359790105305834996978755923950077317381403267").unwrap(),
            BigInt::from_str("10861549147121384785495888967464291400837754556942768811917754795517438910238").unwrap(),
            BigInt::from_str("7537538922575546318235739307792157434585071385790082150452199061048979169447").unwrap(),
            BigInt::from_str("19170203992070410766412159884086833170469632707946611516547317398966021022253").unwrap(),
            BigInt::from_str("9623414539891033920851862231973763647444234218922568879041788217598068601671").unwrap(),
            BigInt::from_str("3060533073600086539557684568063736193011911125938770961176821146879145827363").unwrap(),
            BigInt::from_str("138878455357257924790066769656582592677416924479878379980482552822708744793").unwrap(),
            BigInt::from_str("15800883723037093133305280672853871715176051618981698111580373208012928757479").unwrap(),
            BigInt::from_str("9637860505097446354938615465189848881949005695944686439357073260024670396314").unwrap(),
            BigInt::from_str("4230405496594752177767097648850446961113946544270644047257607903635152146286").unwrap(),
            BigInt::from_str("19628479516823977714752192155233860702021283416105762098991390975512642753356").unwrap(),
            BigInt::from_str("10752138434985301760908661169020382294921002953248926091133111238568141278402").unwrap(),
            BigInt::from_str("8832152504624700401449770057167890569321131921984669229014434815887358390937").unwrap(),
            BigInt::from_str("11347004614081717932944125175785689632220946418443796094366660816613526692072").unwrap(),
            BigInt::from_str("3051443875805177528988564130066437194733628010868431898106208700997051204511").unwrap(),
            BigInt::from_str("3280843894647711167665805442383284798908343826207825003222378769830753112564").unwrap(),
            BigInt::from_str("2885437127318082792676156679496224267537134149125889704006255090894418859184").unwrap(),
            BigInt::from_str("20997803921471190972687386845252368449417136221584210407219428552891406603152").unwrap(),
            BigInt::from_str("5526870653502991543758325832857419578849790775006776838934982108475732717180").unwrap(),
            BigInt::from_str("7121835997534288329666907007610599371471281090342639163249422125882346004294").unwrap(),
            BigInt::from_str("15719921527343108453815280463150889897757364775758887789128455974508289567119").unwrap(),
            BigInt::from_str("6800756350329941818747258477810389805396246928207995810517009958263101553489").unwrap(),
            BigInt::from_str("2387746328953913964516034941438126107024105766257836521162337617493519233192").unwrap(),
            BigInt::from_str("18389291119450341474688802783873028936913064106686703340023236059134361426593").unwrap(),
            BigInt::from_str("8266189338878712940143733925681146922544677859926525777594956900994956848732").unwrap(),
            BigInt::from_str("21311906646723129072990686647412554508151535295237999786157781083658467767089").unwrap(),
            BigInt::from_str("8131505769780307031712581351087477450232389608257956681178511066447607843600").unwrap(),
            BigInt::from_str("9491497623334998525022201191647456809098737897223950870494984437127015761037").unwrap(),
            BigInt::from_str("12722936037872413219104533339381884231531663271833546485930360199704439391196").unwrap(),
        ],
    };

    let WTNS_PATH = "../build/merkle40/merkle40_js/merkle40.wasm";
    let R1CS_PATH = "../build/merkle40/merkle40.r1cs";

    merkle_proof(c, MERKLE_INPUTS_40, WTNS_PATH, R1CS_PATH);
}

pub fn groth16_merkle_proof_bench_128(c: &mut Criterion) {
    let MERKLE_INPUTS_128: MerkleInputs = MerkleInputs {
        root: BigInt::from_str("21721294983115516952968686348295663637028049375596886402366263900309894815732").unwrap(),
        leaf: BigInt::from_str("18586133768512220936620570745912940619677854269274689475585506675881198879027").unwrap(),
        in_path_indices: BigInt::from_str("0").unwrap(),
        in_path_elements: vec![
            BigInt::from_str("14522046728041339886521211779101644712859239303505368468566383402165481390632").unwrap(),
            BigInt::from_str("12399300409582020702502593817695692114365413884629119646752088755594619792099").unwrap(),
            BigInt::from_str("8395588225108361090185968542078819429341401311717556516132539162074718138649").unwrap(),
            BigInt::from_str("4057071915828907980454096850543815456027107468656377022048087951790606859731").unwrap(),
            BigInt::from_str("3743829818366380567407337724304774110038336483209304727156632173911629434824").unwrap(),
            BigInt::from_str("3362607757998999405075010522526038738464692355542244039606578632265293250219").unwrap(),
            BigInt::from_str("20015677184605935901566129770286979413240288709932102066659093803039610261051").unwrap(),
            BigInt::from_str("10225829025262222227965488453946459886073285580405166440845039886823254154094").unwrap(),
            BigInt::from_str("5686141661288164258066217031114275192545956158151639326748108608664284882706").unwrap(),
            BigInt::from_str("13358779464535584487091704300380764321480804571869571342660527049603988848871").unwrap(),
            BigInt::from_str("20788849673815300643597200320095485951460468959391698802255261673230371848899").unwrap(),
            BigInt::from_str("18755746780925592439082197927133359790105305834996978755923950077317381403267").unwrap(),
            BigInt::from_str("10861549147121384785495888967464291400837754556942768811917754795517438910238").unwrap(),
            BigInt::from_str("7537538922575546318235739307792157434585071385790082150452199061048979169447").unwrap(),
            BigInt::from_str("19170203992070410766412159884086833170469632707946611516547317398966021022253").unwrap(),
            BigInt::from_str("9623414539891033920851862231973763647444234218922568879041788217598068601671").unwrap(),
            BigInt::from_str("3060533073600086539557684568063736193011911125938770961176821146879145827363").unwrap(),
            BigInt::from_str("138878455357257924790066769656582592677416924479878379980482552822708744793").unwrap(),
            BigInt::from_str("15800883723037093133305280672853871715176051618981698111580373208012928757479").unwrap(),
            BigInt::from_str("9637860505097446354938615465189848881949005695944686439357073260024670396314").unwrap(),
            BigInt::from_str("4230405496594752177767097648850446961113946544270644047257607903635152146286").unwrap(),
            BigInt::from_str("19628479516823977714752192155233860702021283416105762098991390975512642753356").unwrap(),
            BigInt::from_str("10752138434985301760908661169020382294921002953248926091133111238568141278402").unwrap(),
            BigInt::from_str("8832152504624700401449770057167890569321131921984669229014434815887358390937").unwrap(),
            BigInt::from_str("11347004614081717932944125175785689632220946418443796094366660816613526692072").unwrap(),
            BigInt::from_str("3051443875805177528988564130066437194733628010868431898106208700997051204511").unwrap(),
            BigInt::from_str("3280843894647711167665805442383284798908343826207825003222378769830753112564").unwrap(),
            BigInt::from_str("2885437127318082792676156679496224267537134149125889704006255090894418859184").unwrap(),
            BigInt::from_str("20997803921471190972687386845252368449417136221584210407219428552891406603152").unwrap(),
            BigInt::from_str("5526870653502991543758325832857419578849790775006776838934982108475732717180").unwrap(),
            BigInt::from_str("7121835997534288329666907007610599371471281090342639163249422125882346004294").unwrap(),
            BigInt::from_str("15719921527343108453815280463150889897757364775758887789128455974508289567119").unwrap(),
            BigInt::from_str("6800756350329941818747258477810389805396246928207995810517009958263101553489").unwrap(),
            BigInt::from_str("2387746328953913964516034941438126107024105766257836521162337617493519233192").unwrap(),
            BigInt::from_str("18389291119450341474688802783873028936913064106686703340023236059134361426593").unwrap(),
            BigInt::from_str("8266189338878712940143733925681146922544677859926525777594956900994956848732").unwrap(),
            BigInt::from_str("21311906646723129072990686647412554508151535295237999786157781083658467767089").unwrap(),
            BigInt::from_str("8131505769780307031712581351087477450232389608257956681178511066447607843600").unwrap(),
            BigInt::from_str("9491497623334998525022201191647456809098737897223950870494984437127015761037").unwrap(),
            BigInt::from_str("12722936037872413219104533339381884231531663271833546485930360199704439391196").unwrap(),
            BigInt::from_str("21138608075883657621559031833017406360096035512553864525026502529621034855337").unwrap(),
            BigInt::from_str("6442665584168748947949358436226769791900191607353113522388595396549232870312").unwrap(),
            BigInt::from_str("7898076587847161046108568539472157838007123648130422015715761498618516909474").unwrap(),
            BigInt::from_str("1658905410913128689034316843981691537080602687353521540873794164796730291928").unwrap(),
            BigInt::from_str("8773280634099669124765732045635483145450220099576683985245026158375511299357").unwrap(),
            BigInt::from_str("5806793743688188971675259565636580245374797847551201837143498076227981108077").unwrap(),
            BigInt::from_str("7423042457551967483721745175532595057563827397189715382646792304580053459814").unwrap(),
            BigInt::from_str("16325995792610881607046187402622370555784513420791568591193285300872946094703").unwrap(),
            BigInt::from_str("8493056946051715357621377028804528857867352502609789516724426940762319392085").unwrap(),
            BigInt::from_str("9995846367000338364243495534649711305667889732585402242184357920753981642910").unwrap(),
            BigInt::from_str("18714141943186601179658207343455059081584265191171989384000795293963252086690").unwrap(),
            BigInt::from_str("19298726554287364653092756354293454960074528369704239611279808518943447489277").unwrap(),
            BigInt::from_str("436417285510409167555506399552533208848999404510808604768557918040014524591").unwrap(),
            BigInt::from_str("16987811584727502478925085760267849128414516011514610554303577787999475831876").unwrap(),
            BigInt::from_str("898295647492872786679167317746072081431825597241734434545273233094820797875").unwrap(),
            BigInt::from_str("6949412565665360029491293851141049831227570480547959468511059912689964444636").unwrap(),
            BigInt::from_str("8209274452497865278277367290601963196197448064187556810280267429969090897440").unwrap(),
            BigInt::from_str("3999885482988763295467936547783266691198088137764409020781369485570983035993").unwrap(),
            BigInt::from_str("20182038579273406773985925477794859413299514679046626019317208294095267066212").unwrap(),
            BigInt::from_str("4973697642676562600545374183791782594849029740379722069779015709627646617613").unwrap(),
            BigInt::from_str("15887244455964512409457795389678278469736843101740433144109371497069167041272").unwrap(),
            BigInt::from_str("6261840900457997176362185784296531877211026049830706213408077082184613436476").unwrap(),
            BigInt::from_str("19648976736596599891388862891543163275163728425125319427275451706620439530168").unwrap(),
            BigInt::from_str("3296050359282063890375278134807291596262054481908471864051605026718457867055").unwrap(),
            BigInt::from_str("14841328526941633297269812918262385080214080003773309378437992152423473875302").unwrap(),
            BigInt::from_str("6386065329755207813179279739350229975118947737094959094701836024702307535354").unwrap(),
            BigInt::from_str("11307094985205543050544874229448602759143903237775404456024304620634656958489").unwrap(),
            BigInt::from_str("9800196030408970116166832095928290881230639941137224094842120751409209654241").unwrap(),
            BigInt::from_str("21276336174093916489656075055931586473850502544236720887430212291951639027785").unwrap(),
            BigInt::from_str("19849710445327185695163460846087842076222530200980926741960811441527587733488").unwrap(),
            BigInt::from_str("6946703471234380308237062415424001215055566086877272676178252292238665264966").unwrap(),
            BigInt::from_str("10731463218045357907665288023270018415070120552605517237140646030521391551535").unwrap(),
            BigInt::from_str("15236212669011212053567104649681486213983548822569317997541358479906363726619").unwrap(),
            BigInt::from_str("11337289355054161472821873251343603312511791620197158091649590036550713148284").unwrap(),
            BigInt::from_str("21693621893416830296259912583411068240938379159642126247095780717862951739437").unwrap(),
            BigInt::from_str("10116100514471010703991027155113142430497050602122433021490781039467420309858").unwrap(),
            BigInt::from_str("16141508339020577534192728994562675052613132744348067423070543049227992069996").unwrap(),
            BigInt::from_str("1491424167385444350918238696996234744177418235595610677451795544056208061665").unwrap(),
            BigInt::from_str("9618226158626888759456377642199176242500101125594314310066188414239808049249").unwrap(),
            BigInt::from_str("10551654572819098396241404457970133029696417583608110727746736249033252112915").unwrap(),
            BigInt::from_str("16304804267252188164749925037245817940287901954656788038173930965142064759225").unwrap(),
            BigInt::from_str("11257473869688997447731279437823799523825190968284485992782884625766864187425").unwrap(),
            BigInt::from_str("9215798478612395181730133431397542215219702711233802896671478067390791485909").unwrap(),
            BigInt::from_str("5806880328873372382976719301253416165695384313728297712878428903503854756298").unwrap(),
            BigInt::from_str("18204395952805346163667529192661218141240268134596179082694639581468017694502").unwrap(),
            BigInt::from_str("9107023805611129203337748265685216775943006602925912257826317029588698678934").unwrap(),
            BigInt::from_str("12493766354277855159743199760121394835652355760207469401136352355491636310329").unwrap(),
            BigInt::from_str("19697123643333467858879573811151054586580020249418990476503480903188066089487").unwrap(),
            BigInt::from_str("2403854443574752356454422401199002535165768551406775172394797625607429978721").unwrap(),
            BigInt::from_str("10011579687314815678544442959416624406375111850765167823417738076887363779870").unwrap(),
            BigInt::from_str("3309025837139298321883765380965914054157434995226391523134802504402589641666").unwrap(),
            BigInt::from_str("8728341323737906350425401536856643974323630862142655513591135415680419211567").unwrap(),
            BigInt::from_str("12400791295096371905761633913770577505585866433910425286308054076986320905656").unwrap(),
            BigInt::from_str("1834297357011121390724560893270291033861720203023981684182162535944237707450").unwrap(),
            BigInt::from_str("9075630457132085534731159277791794768903083621967786553837590604151280682908").unwrap(),
            BigInt::from_str("21727058951291916880896055524217673581109190142502881140670516584818529475724").unwrap(),
            BigInt::from_str("3039795106288162295435945406479197297530734931727262385895107193699772516535").unwrap(),
            BigInt::from_str("6518402359481550121315960602418303589173282033154429264168621917035028006411").unwrap(),
            BigInt::from_str("5605057897577415167776333961819522242488861900262609972061608313375685191470").unwrap(),
            BigInt::from_str("16670096204735011720045098172299946505937191010112119134266617645269365962077").unwrap(),
            BigInt::from_str("1649844379074077996629723400985038942087144407926066790888645539821050047534").unwrap(),
            BigInt::from_str("16253259115186459796960680901146523985264821505448698227517465481453314634282").unwrap(),
            BigInt::from_str("11912196912063765576546921161876763162413713596079853659644388848906471596027").unwrap(),
            BigInt::from_str("16626135598801143663505967623053517837435854928421195261192035729185256020227").unwrap(),
            BigInt::from_str("7589157020795431938961902303532134976877051953966401728639701925421446127869").unwrap(),
            BigInt::from_str("15509964993803361358368162058440544163556663443292938817743270939144583095906").unwrap(),
            BigInt::from_str("122830371877071100068587596198273635798840766474380953513473190045650511950").unwrap(),
            BigInt::from_str("8947328648435368097474467408667583289135826587564752404745369494682296131929").unwrap(),
            BigInt::from_str("6390363108519929657988124760500954703701438891423620134821189644638354128837").unwrap(),
            BigInt::from_str("5751863493578447050677221850675296509566083100683787519709985661923870390577").unwrap(),
            BigInt::from_str("12529305751482304048915966583561922190184876752695893895372165932533953630830").unwrap(),
            BigInt::from_str("13718823359613949930477224419471912566384185223111668760721455052666974096397").unwrap(),
            BigInt::from_str("4607451659601508647993965407295098286172261983891536885193242169197677191427").unwrap(),
            BigInt::from_str("18314544992935042248240906596771537576627933821272767270104167070681436787112").unwrap(),
            BigInt::from_str("2125053654063060522399077078534088797668669527645480427898246038079337233589").unwrap(),
            BigInt::from_str("8171188229261567625337313153172700986792860791632566357809192439669850850772").unwrap(),
            BigInt::from_str("17443929448527922972351567116831759420403151769667296821444137703840760070086").unwrap(),
            BigInt::from_str("136421240892943717105815587974738115272213047442578311446801712534338308428").unwrap(),
            BigInt::from_str("1080947937983611681002152717872320646076378431952379126986283379509003452653").unwrap(),
            BigInt::from_str("6251888335379522902030595524528182163726524097009313159583655187771973687641").unwrap(),
            BigInt::from_str("10181102307194415926606941080461960183992649603381163986486880702376622482945").unwrap(),
            BigInt::from_str("7114848723996599656976006608333019078944548879049772722159646382038459531240").unwrap(),
            BigInt::from_str("2906030404070710643927313931781642053667306666738265017459408716747852614809").unwrap(),
            BigInt::from_str("9710781607355499646220568589443892702844194900204686601088371882891229805055").unwrap(),
            BigInt::from_str("7860673116175196275951707924104661609181342356984883969970342680519732405845").unwrap(),
            BigInt::from_str("2062449040992449369331370156844606459544409469381953331809287994166829390457").unwrap(),
            BigInt::from_str("18422908154894943964183908542609677768841814764055921005047808570087058883537").unwrap(),
            BigInt::from_str("14503605542479369488467533521539370180724347890012449406696066230848230464340").unwrap()],
    };

    let WTNS_PATH = "../build/merkle40/merkle40_js/merkle40.wasm";
    let R1CS_PATH = "../build/merkle40/merkle40.r1cs";

    merkle_proof(c, MERKLE_INPUTS_128, WTNS_PATH, R1CS_PATH);
}

fn proof(c: &mut Criterion, merkle_inputs: MerkleInputs, wtns: &str, r1cs: &str) {
    let merkle_height = merkle_inputs.in_path_elements.len();
    let path = format!(
        "./build/merkle{}/circuit.zkey",
        merkle_height
    );

    let mut file = File::open(path).unwrap();
    let (params, matrices) = read_zkey(&mut file).unwrap();
    let num_inputs = matrices.num_instance_variables;
    let num_constraints = matrices.num_constraints;

    let inputs = {
        let mut inputs: HashMap<String, Inputs> = HashMap::new();
        inputs.entry("root".to_string()).or_insert_with(|| Inputs::BigInt(merkle_inputs.root));
        inputs.entry("leaf".to_string()).or_insert_with(|| Inputs::BigInt(merkle_inputs.leaf));
        inputs.entry("inPathIndices".to_string()).or_insert_with(|| Inputs::BigInt(merkle_inputs.in_path_indices));
        inputs.entry("inPathElements".to_string()).or_insert_with(|| Inputs::BigIntVec(merkle_inputs.in_path_elements));
        inputs
    };

    let mut wtns = WitnessCalculator::new(format!(
        "./build/merkle{}/merkle{}_js/merkle{}.wasm",
        merkle_height, merkle_height, merkle_height
    ))
        .unwrap();

    let full_assignment = wtns
        .calculate_witness_element::<Bn254, _>(
            inputs,
            false
        )
        .unwrap();

    let mut rng = thread_rng();
    use ark_std::UniformRand;
    let rng = &mut rng;

    let r = ark_bn254::Fr::rand(rng);
    let s = ark_bn254::Fr::rand(rng);

    let proof = Groth16::<Bn254, CircomReduction>::create_proof_with_reduction_and_matrices(
        &params,
        r,
        s,
        &matrices,
        num_inputs,
        num_constraints,
        full_assignment.as_slice(),
    )
        .unwrap();

}
fn merkle_proof(c: &mut Criterion, inputs: MerkleInputs, wtns: &str, r1cs: &str) {
    let merkle_height = inputs.in_path_elements.len();
    let cfg = CircomConfig::<Bn254>::new(
        wtns,
        r1cs,
    ).unwrap();

    let mut builder = CircomBuilder::new(cfg);
    builder.push_input("root", Inputs::BigInt(inputs.root));
    builder.push_input("inPathElements", Inputs::BigIntVec(inputs.in_path_elements));
    builder.push_input("inPathIndices", Inputs::BigInt(inputs.in_path_indices));
    builder.push_input("leaf", Inputs::BigInt(inputs.leaf));

    let circom = builder.setup();
    let mut rng = thread_rng();
    let params = GrothBn::generate_random_parameters_with_reduction(circom, &mut rng).unwrap();
    let circom = builder.build().unwrap();
    let circom_inputs = circom.get_public_inputs().unwrap();
    let bench_id = &format!("prove {}", merkle_height);
    c.bench_function(
        bench_id,
        |b| b.iter(|| GrothBn::prove(&params, circom.clone(), &mut rng).unwrap()),
    );

    // let pvk = GrothBn::process_vk(&params.vk).unwrap();
    // let verified = GrothBn::verify_with_processed_vk(&pvk, &circom_inputs, &proof).unwrap();
    // println!("Proof verified: {:?}", verified);
    // assert!(verified);
}


pub fn config_criterion() -> Criterion {
    Criterion::default()
        .sample_size(100)
        .warm_up_time(std::time::Duration::from_secs(5))
        .measurement_time(std::time::Duration::from_secs(10))
}

criterion_group! {
    name = benches;
    config = config_criterion();
    targets = groth16_merkle_proof_bench_22, groth16_merkle_proof_bench_30, groth16_merkle_proof_bench_40
}
criterion_main!(benches);
